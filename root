{"version":1,"ops":[{"type":1,"author":{"id":"6040c0554c714a15bfcee150498785e13bbbf98a"},"timestamp":1600177766,"metadata":{"github-id":"MDU6SXNzdWU3MDE5NDczODM=","github-url":"https://github.com/firecat53/keepmenu/issues/64","origin":"github"},"title":"Getting re-prompted for passphrase for existing connections","message":"I noticed when I connect to some WiFi networks, I'm always getting prompted for the passphrase despite them being saved connections.\n\nThis is due to the connection filtering based on `i.get_setting_wireless().get_mac_address()` in `process_ap`.\n\nLooking at the values we have in `CONNS`, it looks like the MAC address is None for all those:\n\n```\n(Pdb) pp [(c.get_filename(), f'MAC: {c.get_setting_wireless().get_mac_address()}' if c.get_setting_wireless() is not None else 'Not wireless') for c in CONNS]\n[('/etc/NetworkManager/system-connections/SBB-FREE.nmconnection',\n  'MAC: A8:7E:EA:redacted'),\n ('/etc/NetworkManager/system-connections/eduroam.nmconnection',\n  'MAC: None'),\n ('/etc/NetworkManager/system-connections/hexenbesen-UPC.nmconnection',\n  'MAC: None'),\n ('/etc/NetworkManager/system-connections/ins.nmconnection',\n  'MAC: None'),\n ('/etc/NetworkManager/system-connections/Hosentascheninternet.nmconnection',\n  'MAC: A8:7E:EA:redacted'),\n ('/etc/NetworkManager/system-connections/Taohuayuan-5.nmconnection',\n  'MAC: A8:7E:EA:redacted'),\n ('/etc/NetworkManager/system-connections/OST-VPN.nmconnection',\n  'Not wireless'),\n ('/etc/NetworkManager/system-connections/Nokia 8 Network.nmconnection',\n  'Not wireless'),\n ('/var/run/NetworkManager/system-connections/Wired connection 1.nmconnection',\n  'Not wireless'),\n ('/var/run/NetworkManager/system-connections/Wired connection 2.nmconnection',\n  'Not wireless')]\n```\n\n\"eduroam\", \"hexenbesen-UPC\" and \"ins\" are all normal WiFi connections to which NetworkManager happily connects without re-asking for a password.\n\nLooking at the `.nmconnection` files, they are missing the `mac-address=A8:7E:EA:redacted` key under `[wifi]`. No idea why. Maybe I added some via keepmenu and some via NetworkManager directly?\n\nIt looks like the filtering was added in d343d211d7ee5bbdf26c713b4baaae35648b3210 for #31 - maybe there should be a `or i.get_setting_wireless().get_mac_address() is None` there as well?","files":null}]}